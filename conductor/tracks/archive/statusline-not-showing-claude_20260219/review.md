# Code Review Report

**Branch:** `bugfix/statusline-not-showing` vs `origin/develop`
**Generated:** 2026-02-19
**Track:** Statusline not showing on Claude Code

---

## Summary

| Metric | Value |
|--------|-------|
| Files Changed | 5 (product code) |
| Lines Added | +281 |
| Lines Removed | -15 |
| **Findings** | ðŸ”´ High: 0 | ðŸŸ¡ Medium: 2 | ðŸŸ¢ Low: 4 |

---

## Code Quality

### High Severity
No high severity issues found.

### Medium Severity

1. **Repeated JSON unmarshaling in accessors** (`internal/hook/hook.go`)
   - `ModelID()`, `ModelDisplayName()`, and `WorkspacePath()` unmarshal `json.RawMessage` on every call without caching.
   - **Impact:** Minimal in practice â€” each accessor is called once per statusline render, and the JSON payloads are small (<200 bytes). Caching would add struct complexity for negligible gain.
   - **Decision:** Accept as-is. The simplicity/correctness tradeoff favors the current approach.

2. **Duplicated "try string then object" pattern** (`internal/hook/hook.go`)
   - `ModelID()` and `WorkspacePath()` follow the same unmarshal-string-then-object pattern.
   - **Impact:** Low â€” only two instances, each with different target types.
   - **Decision:** Accept. Extracting a generic helper would require type parameters or interface{}, adding complexity without meaningful benefit for two call sites.

### Low Severity

1. Deprecated `Model()`/`Workspace()` methods lack removal timeline in docs.
2. `UnmarshalJSON` doesn't validate required field presence (acceptable â€” zero values are the graceful degradation path).

---

## Security Analysis

### Critical/High Severity
No security vulnerabilities detected.

### Medium Severity
No medium severity security issues.

**Notes:** The code handles untrusted stdin input appropriately â€” JSON parsing uses stdlib, errors return empty strings (safe defaults), and no user input reaches exec/eval paths. No hardcoded secrets, no injection vectors.

---

## Test Coverage

### Coverage by Package

| Package | Coverage | Target | Status |
|---------|----------|--------|--------|
| hook | 84.4% | >80% | âœ… |
| render | 100% | >80% | âœ… |
| segments | 92.3% | >80% | âœ… |
| config | 92.2% | >80% | âœ… |
| themes | 100% | >80% | âœ… |

### Missing Tests
All changed files have corresponding tests.

### Suggested Improvements (non-blocking)
- Add test for `ModelID()`/`WorkspacePath()` fallback when field is an unexpected JSON type (array, number)
- Add test for deprecated `Model()`/`Workspace()` backward compat methods
- Add renderer test with multi-byte UTF-8 characters to validate rune counting edge case

---

## Recommendations

**Priority Actions (address before merging):**
None â€” no blocking issues found.

**Suggested Improvements:**
1. Consider caching parsed model/workspace in a future optimization pass if accessor calls increase
2. Add deprecation timeline to `Model()`/`Workspace()` method docs

---

*Auto-review generated by `/conductor:implement` on track completion*
