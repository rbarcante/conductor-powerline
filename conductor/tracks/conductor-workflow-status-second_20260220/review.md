# Code Review Report

**Branch:** `feature/conductor-workflow-line` vs `origin/main`
**Generated:** 2026-02-20
**Track:** Conductor workflow status second line

---

## Summary

| Metric | Value |
|--------|-------|
| Files Changed | 11 product files |
| Key New Files | workflow_cli.go, workflow.go, +test files |
| **Findings** | ðŸ”´ High: 0 \| ðŸŸ¡ Medium: 5 \| ðŸŸ¢ Low: 7 |

---

## Code Quality

### High Severity
No high severity issues found.

### Medium Severity

- **Goroutine data sharing pattern** (`main.go:64`) â€” `usageData` and `workflowData` are written by goroutines and read after `wg.Wait()`. Correct today but fragile; future refactors could silently introduce races. *Suggestion: use channels for result passing.*

- **Package-level mutable `execCommandFunc`** (`workflow_cli.go:55`) â€” global test seam is not parallel-test-safe. *Suggestion: struct-based CLI runner with injected command func.*

- **`nerdFonts` parameter unused** (`workflow.go:55,78`) â€” `WorkflowTasks` and `WorkflowOverall` accept but never use `nerdFonts`. *Suggestion: remove until needed.*

- **`selectActiveTrack` called twice per render** (`workflow.go:35,60`) â€” redundant iteration; compute once in `buildWorkflowSegments`. *Suggestion: pass `*WorkflowTrackInfo` to segments that need it.*

- **Magic strings for track status** (`workflow.go:84,110`) â€” `"in_progress"` and `"completed"` as string literals. *Suggestion: define named constants.*

### Low Severity

- **Glob version sorting** (`workflow_cli.go:75`) â€” lexicographic sort fails for semver â‰¥10.x. Document the limitation.
- **Theme nil-safety** (`workflow.go:13`) â€” no warning when theme lacks workflow keys (returns empty FG/BG strings).
- **`UpdatedAt` string comparison** (`workflow.go`) â€” works for ISO 8601 but fragile; parse to `time.Time` for robustness.
- **Nested `Tracks.Tracks`** â€” `data.Tracks.Tracks` double nesting mirrors CLI JSON but is ergonomically odd in Go.
- **`os.UserHomeDir()` called multiple times** (`main.go`) â€” call once and pass through.

---

## Security Analysis

### Critical/High Severity
No security vulnerabilities detected.

### Medium Severity

- **Glob-discovered script path** (`workflow_cli.go:91`) â€” any file matching `~/.claude/plugins/cache/claude-conductor/conductor/*/scripts/conductor_cli.py` is executed. Requires pre-existing write access to the user's home dir (already implies significant compromise). Defense-in-depth concern only; no practical attack vector.

### Low Severity

- Package-level `execCommandFunc` is an accepted Go testing pattern; no external exposure.
- Debug logging includes full CLI path when `CONDUCTOR_DEBUG=1` â€” standard, gated behavior.

---

## Test Coverage

### Estimated Coverage: 88-92%

**All changed source files have corresponding test files.** âœ…

| File | Tests | Key Cases |
|------|-------|-----------|
| `workflow_cli.go` | `workflow_cli_test.go` | success, not-found, failure, timeout, malformed JSON, success=false |
| `workflow.go` | `workflow_test.go` | all 4 segments Ã— nil/empty/active data, all 6 themes |
| `main.go` | `main_test.go` | two-line integration test + disabled config test |

### Missing Tests (Low Priority)
- `FindConductorCLI("")` with empty homeDir (OS fallback path)
- Multiple version directories â€” verifies last match is selected
- `WorkflowSetup` with `IsValid=false, SetupComplete=true`
- Integration test for CLI failure while conductor is active (line 1 still renders)

---

## Recommendations

**Priority Actions (address before merging):**
None â€” no blocking issues found.

**Suggested Improvements:**
1. Remove unused `nerdFonts` parameter from `WorkflowTasks`/`WorkflowOverall` (or implement the icon support)
2. Define `TrackStatusInProgress` and `TrackStatusCompleted` string constants
3. Call `os.UserHomeDir()` once in `run()` and thread through
4. Add test for multiple CLI version directories

---

*Auto-review generated by `/conductor:implement` on track completion*
